/*
 * Check if other occurences exist
 */
 
console.show();
console.clear();

load(__DIR__ + "./common/c_Namespace.ajs");
load(__DIR__ + "./common/c_Selection.ajs");
load(__DIR__ + "./common/c_Model.ajs");
load(__DIR__ + "./tests/c_Test.ajs");


var selectedOccurences = CSelection_GetDirectlySelectedOccurences();
//CTest_LogObjectListWithType(selectedOccurences);


if (selectedOccurences.size() > 1) {
	window.alert("Several objects selected. Please select only one element or relationship object. Exiting...");
	exit();
}
else if (selectedOccurences.size() < 1) {
	window.alert("No objects selected. Please select an element or relationship object. Exiting...");
	exit();
}
	
var selectedOccurence = selectedOccurences.first();


//console.log("Selected " + selectedOccurence.name);


var others = cModel_OtherConceptsWithSameNameandType(selectedOccurence, false, false); // caseSensitive, namespaceSensitive

console.log("others.size = " + others.size());

var strListOfOtherConceptsWithSameNameandType = "";

others.each(function(o) {
	
	if (strListOfOtherConceptsWithSameNameandType != "")
		strListOfOtherConceptsWithSameNameandType += "; ";
	
	strListOfOtherConceptsWithSameNameandType += o.name + "\t" + o.id;
		
});

if (others.size() == 1 ) {

	var str = "Another concept with the same name as the selected object exists!" 
				+ "\n\n"
				+ "\t\t\t" + "Name" + "\t" + "Id"
				+ "\n"
				+ "1. Selected concept:\t\t" + selectedOccurence.name + "\t" + selectedOccurence.id 
				+ "\n"
				+ "2. Other concept:\t\t" + strListOfOtherConceptsWithSameNameandType;
				
	str += "\n\nMerge and use the existing #2?\n"

	var merge = window.confirm(str);
	
	if (merge) {
		
		window.alert("Super... just wait a moment for the merge implementation;)");
	
	}
	else
		window.alert("OK -no merging - no harm;)");
		
	
		
	
	
}
else if (others.size() > 1 ) {
	
	/*
	var alertStr = "Several other concepts with the same name as the selected object exist for \n"
					+ selectedOccurence.name + ", " + selectedOccurence.id 
					+ "\nare\n" 
					+ strListOfOtherConceptsWithSameNameandType;	
	*/				
	
	/*	
	var alertStr = "Several other concepts with the same name as the selected object exist for \n"
					+ "\t\t\t" + "Name" + "\t" + "Id"
					+ "\n"
					+ "1. Selected concept:\t\t" + selectedOccurence.name + "\t" + selectedOccurence.id 
					+ "\n"
					+ "2. Other concept:\t\t" + strListOfOtherConceptsWithSameNameandType;	
	*/				
	var alertStr = "Several other concepts with the same name as the selected object exist for \n"
					+ "\t\t\t" + "Name" + "\t" + "Id"
					+ "\n"
					+ "1. Selected concept:\t\t" + selectedOccurence.name + "\t" + selectedOccurence.id 
					+ "\n";
					
					
					
					+ "2. Other concept:\t\t" + strListOfOtherConceptsWithSameNameandType;					
	
	window.alert(alertStr);
	
	//window.confirm("ok");
}
else {
	window.alert("No other concepts exist for the select object");
}

